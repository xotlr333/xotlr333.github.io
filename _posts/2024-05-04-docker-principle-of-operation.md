---
layout: post
title: 도커의 동작원리
date: 2024-05-04
categories: [Docker]
tags: [동작원리]
---
# 2. 도커의 동작 원리

## 도커의 구조

<img width="278" alt="Untitled" src="https://github.com/xotlr333/xotlr333.github.io/assets/81614820/8d607c23-3c1b-4da8-8577-9a84d853c292">

- 도커에서는 컨테이너가 완전히 분리돼 있으므로 밑바탕이 되는 리눅스 운영체제의 주변 부분이 컨테이너 속 프로그램의 명령을 전달받을 수 없다. 따라서 컨테이너 속에 운영체제의 주변 부분이 들어 있어 프로그램의 명령을 전달받고 이를 밑바탕이 되는 커널에 전달하는 구조로 돼 있다.
- 이런 구조로 도커의 가장 큰 특징인 **‘가벼움’**을 얻을 수 있다.

## 도커 이미지

- 컨테이너를 찍어내는 ‘빵틀’과 같은 것으로, 컨테이너의 설계도 역할을 한다.
- 이미지는 금형과 같은 역할을 하는 것으로, 하나만 있으면 똑같은 것을 여러 개 만들 수 있다.
- 따라서 동일한 컨테이너를 여러 개 배치하기 편리하다.

<img width="489" alt="Untitled 1" src="https://github.com/xotlr333/xotlr333.github.io/assets/81614820/3e3732ee-acd9-48ed-8991-3ca9dc18240c">

## 도커 컨테이너의 생애주기

- 컨테이너 하나를 업데이트하면서 계속 사용하기보다는 업데이트된 소프트웨어가 들어있는 새로운 컨테이너를 사용하는 것을 권장한다.
- 컨테이너는 일반적으로 여러 개를 동시 가동하는 상황을 전제로 하기 때문에 여러 개의 컨테이너를 하나하나 업데이트하려면 많은 수고가 든다.
- 유지보수할 때마다 컨테이너를 일일이 업데이트하려니 컨테이너의 장점이 반감된다.
- 이러한 이유로 오래된 컨테이너를 버리고 새로운 이미지로부터 새로운 컨테이너를 만들어 갈아타는 방식을 사용한다.
- 이렇듯 컨테이너를 ‘만들고’, ‘실행하고’, ‘종료하고’, ‘폐기한’ 다음, 다시 컨테이너를 ‘만드는’ 일련의 과정을 **‘컨테이너의 생애주기’**라고 부른다.

<img width="437" alt="Untitled 2" src="https://github.com/xotlr333/xotlr333.github.io/assets/81614820/1909d262-96c0-44cd-8091-2b77f2a53939">

<img width="428" alt="Untitled 3" src="https://github.com/xotlr333/xotlr333.github.io/assets/81614820/8dacc104-d015-453a-9d33-fc5ed589deff">

## 데이터 저장

- 컨테이너 안에 있는 데이터를 도커가 설치된 물리적 서버(호스트)의 디스크를 마운트해 이 디스크에 데이터를 저장할 수 있다.
- 이런 방법으로 컨테이너가 폐기되더라도 데이터는 컨테이너 외부에 저장되어 사라지지 않는다.
- 그리고 데이터를 이렇게 외부에 저장하면 다른 컨테이너와 데이터를 공유할 수도 있다.

<img width="221" alt="Untitled 4" src="https://github.com/xotlr333/xotlr333.github.io/assets/81614820/a252ebe4-97ae-47e9-8c56-a03162ab6543">

## 도커의 성질

<img width="494" alt="Untitled 5" src="https://github.com/xotlr333/xotlr333.github.io/assets/81614820/8180709c-dcdc-4a70-a817-307694e7e328">

## 도커의 장점

### 1. 한 대의 물리 서버에 여러 대의 서버를 띄울 수 있다

- 도커는 격리된 환경을 제공하므로 이들이 각각 안전한 상태로 실행되며, 일반적인 서버에서는 함께 실행할 수 없는 조합(같은 소프트웨어를 여러 벌 실행하는)도 가능하다.
- 또한, 컨테이너에는 커널이 포함되지 않으므로 물리 서버의 운영체제에 의존한다. 이러한 이유로 소프트웨어적으로 하드웨어를 재현하는 가상화 기술에 비하면 압도적으로 가볍다.

### 2. 서버 관리가 용이하다

- 컨테이너로 소프트웨어가 격리되어 있으므로 다른 소프트웨어에 영향을 끼치지 않는다.
- 업데이트도 그만큼 간다하여 항상 최신 상태로 소프트웨어를 유지하기 쉬운 구조이다.
- 또한 컨테이너 교체나 수정이 쉬우므로 환경 이전도 간단하다.

### 3. 서버 고수가 아니어도 다루기 쉽다

- 명령 한 줄로 서버 구축이 끝나므로 ‘터미널에 명령을 직접 입력해야 한다는’ 것 이외에는 장애물이 없다.

## 도커의 단점

### 1. 리눅스 운영체제만 가능하다

- 리눅스 운영체제를 사용하는 기술이므로 리눅스용 소프트웨어밖에 지원하지 않는다.

### 2. 호스트 서버의 문제 발생 시 영향이 크다

- 물리 서버 한 대에 여러 대의 서버를 띄우는 형태이므로 호스트 서버에 문제가 생기면 모든 컨테이너에 영향이 미친다.
- 그만큼 물리 서버의 이상에 대해 확실한 대책을 세워야 한다.

### 3. 컨테이너 하나만 사용할 경우 도커는 의미가 없다

- 컨테이너를 여러 개 사용하는 형태를 가정하므로 컨테이너 하나를 장기간에 걸쳐 사용할 때는 그리 큰 장점을 느끼기 어렵다.
- 애초에 도커를 사용하려면 반드시 도커 엔진을 구동해야 하는데, 컨테이너를 하나밖에 사용하지 않는다면 도커 엔진이 단순한 오버헤드에 지나지 않기 때문이다.

## 도커의 주 용도

### 1. 팀원 모두에게 동일한 개발환경 제공하기

### 2. 새로운 버전의 테스트

- 컨테이너 형태를 유지하는 한 도커 엔진이 구동을 보장해 주므로 물리 서버와의 상성은 고려하지 않아도 된다.
- 새로운 버전뿐만 아니라 변경된 환경에 대한 테스트에도 유용하다.

### 3. 동일한 서버가 여러 대 필요한 경우

- 동일한 서버가 여러 대 필요한 경우에도 컨테이너를 이용해 한 대의 물리 서버에 똑같은 서버를 여러 개 만들 수 있다.
- 이렇게 하면 관리도 간편하고 물리 서버를 여러 개의 컨테이너가 공유하므로 비용도 절약할 수 있다.

---
참고)  
도서-그림과 실습으로 배우는 도커&쿠버네티스