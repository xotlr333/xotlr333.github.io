---
layout: post
title: 1. 쿠버네티스 아키텍처
date: 2024-05-24
categories: [Kubernetes, 2.쿠버네티스 기본 개념]
tags: [아키텍처]
---

## 쿠버네티스 구조

- **쿠버네티스 클러스터** : **쿠버네티스의 여러 리소스를 관리하기 위한 집합체**입니다. 따라서 마스터 노드와 워커 노드를 이용해 하나의 쿠버네티스 클러스터를 구성할 수 있습니다.
- **마스터 노드** : **쿠버네티스 클러스터 전체를 관리하는 시스템**으로, 컨트롤 플레인(control plane)이라고도 합니다.
- **워커 노드** : **마스터 노드에 의해 명령을 받아 파드를 생성하고 서비스한다**고 해서 컴퓨팅 머신(computing machine)이라고도 합니다.
- **컨테이너 런타임** : 컨테이너 런타임은 **파드를 실행하는 엔진**입니다. 대표적으로 도커가 있으며, 그 밖에도 컨테이너디, 크라이오 등이 런타임 엔진으로 많이 사용되고 있습니다.
- **영구 스토리지** : 파드는 기본적으로 휘발성입니다. 워커 노드에 떠 있는 파드가 삭제되면 파드 안의 모든 데이터도 즉시 삭제됩니다. 따라서 데이터베이스 같은 중요한 데이터는 파드 외부에 있는 영구 스토리지에 저장해 두어야 합니다. 그리고 CSI(Container Storage Interface)로 외부 스토리지를 파드에 연결할 수 있습니다.

![Untitled](https://github.com/xotlr333/xotlr333.github.io/assets/81614820/48671bc2-cb9d-4fd4-a9c9-24f0aa807070)

## 쿠버네티스 컴포넌트

- **매니페스트(manifest)** : 쿠버네티스는 **새로운 파드를 배포할 때 yaml 파일을 작성해 실행하고 관리**합니다. 쿠버네티스에서는 이러한 **yaml 파일**들을 매니페스트라고 합니다.

### API 서버

- **API 서버**는 **쿠버네티스 클러스터의 API를 사용할 수 있게 해주는 프로세스**로, 클러스터로 요청이 들어왔을 때 그 요청이 유효한지 검증합니다.

![Untitled 1](https://github.com/xotlr333/xotlr333.github.io/assets/81614820/c460c57b-8751-49f7-af7e-e6f98a52a112)

1. 가장 먼저 **사용자 인증**합니다. 즉, 클러스터에 접속할 권한이 있는 사용자인지를 검증합니다.
2. 사용자가 보낸 **명령어를 검증**합니다. 예를 들어 명령어가 문법에 맞게 작성되었는지 절차가 맞는지 등을 검증합니다.
3. **사용자의 요청에 따라 파드를 생성**합니다. 이때 중요한 것은 API 서버가 워커 노드에 파드를 생성하도록 요청했지만 아직 생성은 안 되었다는 점입니다.

### etcd

- API 서버는 파드를 만든다는 사실을 etcd에 알리고 사용자에게 파드가 생성되었음을 알립니다.
- **etcd**는 **클러스터의 상태를 저장**합니다.
- 다시 말해 **클러스터에 필요한 정보, 파드와 같은 리소스들의 상태 정보가 담겨 있는 곳**이 etcd입니다.
- 이 정보들은 **키-값 형태로 저장**됩니다.

![Untitled 2](https://github.com/xotlr333/xotlr333.github.io/assets/81614820/21c347bc-8376-4016-b843-dcf634e52c04)

### 스케줄러

- **스케줄러**는 **파드를 위치시킬 적당한 워커 노드를 확인하고 API 서버에 이 사실을 알립**니다.
- 이후 API 서버는  etcd에 해당 정보(어떤 워커 노드에 파드가 생성될지에 대한 정보)를 저장합니다.
- 워커 노드의 리소스(CPU, 메모리 등 사용량)을 참조해서 위치를 결정합니다.

![Untitled 3](https://github.com/xotlr333/xotlr333.github.io/assets/81614820/1f7c1a01-aab7-4445-8c3f-94e7edf084e6)

### kubelet

- API 서버는 파드가 생성될 워커 노드에 있는 kubelet에 파드의 생성 정보를 전달합니다.
- 이후 kubele은 **해당 정보를 이용해 파드를 생성**합니다.
- 이제서야 비로소 파드가 생성된 것입니다.
- 이처럼 **kubelet**은 **클러스터의 각 노드에서 실행되는 에이전트로, 파드에서 컨테이너의 동작(생성 및 운영)을 관리**합니다.

![Untitled 4](https://github.com/xotlr333/xotlr333.github.io/assets/81614820/ffd9c829-405f-420b-a433-b9da521d4e8f)

- 파드를 생성했다면 kubelet은 다시 API 서버에 생성된 파드의 정보를 전달하고 API 서버는 다시 etcd를 업데이트합니다.

![Untitled 5](https://github.com/xotlr333/xotlr333.github.io/assets/81614820/6110c667-8141-4372-a7bf-6015e7539ff6)

### 컨트롤러 매니저

- 컨트롤러 매니저는 **kube-controller-manager**와 **cloud-controller-manager** 두 가지 유형이 있습니다.
- **kube-controller-manager**는 **다양한 컴포넌트의 상태를 지속적으로 모니터링하는 동시에 실행 상태를 유지하는 역할**을 합니다.
- **cloud-controller-manager**는 **EKS, AKS 같은 퍼블릭 클라우드에서 제공하는 쿠버네티스와 연동되는 서비스들을 관리**합니다.

### 프록시

- 프록시는 클러스터의 모든 노드에서 실행되는 네트워크의 프록시입니다.
- **클러스터 내부와 외부에 대한 통신을 담당**합니다.

### 컨테이너 런타임

- 컨테이너 런타임은 컨테이너 실행을 담당합니다.





---
참고)  
도서-쉽게 시작하는 쿠버네티스