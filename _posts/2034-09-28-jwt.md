---
layout: post
title: 인증/인가 JWT 방식
date: 2023-09-28
categories: [JAVA, 보안]
tags: [인증/인가]
---

# 정의

Json Web Token의 약자로 인증에 필요한 정보들을 암호화시킨 JSON 토근을 의미합니다. JWT 기반 인증은 JWT 토큰을 HTTP 헤더에 담아 서버가 클라언트를 식별하는 방식입니다.

JWT는 JSON 데이터를 Base64 URL-safe Encode를 통해 인코딩하여 직렬화한 것이며, 토큰 내부에는 위변조 방지를 위한 개인키를 통한 전자서명도 들어있습니다.

![JWT정의](https://github.com/xotlr333/xotlr333.github.io/assets/81614820/045b40bd-b703-495d-a4a2-6bdc50198c53)

# 인증 방식

보통 서버가 클라언트 인증을 확인하는 방식은 대표적으로 쿠키, 세션, 토큰 3가지 방식이 있습니다.

## 쿠키(Cookie) 인증

쿠키는 key-value 형식의 문자열 덩어리 입니다. 쿠키는 클라이언트의 브라우저에 저장되고 서버에 요청할때 쿠키를 같이 보내서 인증합니다.

1. 브라우저(클라이언트)가 서버에 요청(접속)을 보낸다.
2. 서버는 클라이언트의 요청에 대한 응답을 작성할 때, 클라이언트 측에 저장하고 싶은 정보를 응답 헤더의 Set-Cookie에 담는다.
3. 이후 해당 클라이언트는 요청을 보낼 때마다, 매번 저장된 쿠키를 요청 헤더의 Cookie에 담아 보낸다. 서버는 쿠키에 담긴 정보를 바탕으로 해당 요청의 클라이언트가 누군지 식별한다.
   - 단점
     - 요청 시 쿠키의 값을 그대로 보내기 때문에 보안에 취약합니다.
     - 용량 제한이 있어 많은 정보를 담을 수 없습니다.
     - 브라우저마다 쿠키에 대한 지원 형태가 다르기 때문에 브라우저간 공유가 불가능합니다.
     - 쿠키의 사이즈가 커질수록 네트워크에 부하가 심해집니다.

## 세션(Session) 인증

세션은 쿠키에 담는 정보를 서버에 저장하고 관리하는 방식입니다. 서버의 메모리에 저장하기도 하고, 서버의 로컬 파일이나 데이터베이스에 저장하기도 합니다.

1. 유저가 웹사이트에서 로그인하면 세션이 서버 메모리(혹은 데이터베이스) 상에 저장됩니다. 이때, 세션을 식별하기 위한 Session Id를 기준으로 정보를 저장합니다.
2. 서버에서 Session Id를 브라우저에 전달하면 브라우저는 쿠키에 Session Id를 저장합니다.
3. 쿠키에 정보가 담겨있기 때문에 브라우저는 해당 사이트에 대한 모든 Request에 Session Id를 쿠키에 담아 전송합니다.
4. 서버는 클라이언트가 보낸 Session Id와 서버 메모리로 관리하고 있는 Session Id를 비교하여 인증을 수행합니다.
   - 단점
     - 서버에서 세션 저장소를 사용하므로 요청이 많아지면 서버에 부하가 심해집니다.

## 토큰(Token) 인증

토큰 기반 인증 시스템은 클라이언트가 서버에 접속을 하면 서버에서 해당 클라이언트에게 인증되었다는 의미로 ‘토큰’을 부여합니다. 이 토큰은 유일합니다. 이제 클라이언트가 서버에 요청을 보낼 때 요청 헤더에 토큰을 같이 보내서 서버에서 토큰을 이용해 인증 절차를 진행합니다.

서버에서 토큰을 관리하지않고 클라이언트에 저장하기 때문에 서버의 부담을 줄일 수 있습니다.

토큰 자체에 데이터가 들어있기 때문에 클라이언트에서 위조되었는지 판별할 수 있습니다.

토큰은 앱과 서버가 통신 및 인증할 때 가장 많이 사용됩니다. 왜냐하면 앱에는 쿠니와 세션이 없기때문입니다.

1. 사용자가 아이디와 비밀번호로 로그인을 합니다.
2. 서버 측에서 클라이언트에게 유일한 토큰을 발급합니다.
3. 클라이언트는 서버 측에서 전달받은 토큰을 쿠키나 스토리지에 저장해 두고, 서버에 요청을 할 때마다 해당 토큰을 요청 헤더에 포함시켜 전달합니다.
4. 서버는 전달받은 토근을 검증하고 요청에 응답합니다. 토큰에는 요청한 사람의 정보가 담겨있기에 서버는 DB를 조회하지 않고 누가 요청하는지 알 수 있습니다.

- 단점
  - 토큰 자체의 데이터가 길어서 인증 요청이 많으면 네트워크 부하가 심해질 수 있습니다.

# JWT

JSON Web Token의 약자로 인증에 필요한 정보들을 암호화시킨 JSON 토큰을 의미합니다.

JWT 기반 인증은 JWT 토큰을 요청 헤더에 포함시켜 서버로 전달합니다.

JWT는 JSON 데이터를 Base64 URL-safe Encode 를 통해 인코딩하여 직렬화한 것이며, 토큰 내부에는 위변조 방지를 위해 개인키를 통한 전자서명도 들어있습니다.

## JWT 구조

JWT는 . 을 구분자로 세가지 문자열로 구성되어있습니다.

.을 기준으로 좌측부터 Header, Payloade, Signature를 의미합니다.

<img width="986" alt="JWT구조" src="https://github.com/xotlr333/xotlr333.github.io/assets/81614820/a753b3e0-74aa-4bb6-9503-f5d0f6c78e05">

- Header : JWT에서 사용할 타입과 해시 알고리즘의 종류를 담는다.
- Payload : 서버에서 첨부한 사용자 권한 정보와 데이터를 담는다.
- Signature : Header, Payload를 Base64 URL-safe Encode를 한 이후 Header에 명시된 해시함수를 적용하고, 개인키로 서명한 전자서명을 담는다.

참고)

[https://inpa.tistory.com/entry/WEB-📚-JWTjson-web-token-란-💯-정리](https://inpa.tistory.com/entry/WEB-%F0%9F%93%9A-JWTjson-web-token-%EB%9E%80-%F0%9F%92%AF-%EC%A0%95%EB%A6%AC)
